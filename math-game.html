<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Math Speed Game</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Comic Sans MS", "Arial", sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 20px;
      }

      .game-container {
        background: white;
        border-radius: 20px;
        padding: 40px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        max-width: 700px;
        width: 70%;
        text-align: center;
      }

      h1 {
        color: #667eea;
        margin-bottom: 30px;
        font-size: 2.5em;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
      }

      .stats {
        display: flex;
        justify-content: center;
        margin-bottom: 10px;
        flex-wrap: wrap;
        gap: 15px;
      }

      .stat-box {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 15px 25px;
        border-radius: 10px;
        min-width: 120px;
        flex: 0 0 auto;
      }

      .stat-label {
        font-size: 0.9em;
        opacity: 0.9;
      }

      .stat-value {
        font-size: 1.8em;
        font-weight: bold;
        margin-top: 5px;
      }

      .question-area {
        background: #f8f9fa;
        padding: 30px;
        border-radius: 15px;
        margin-bottom: 30px;
      }

      .question {
        font-size: 3em;
        color: #333;
        margin-bottom: 20px;
        font-weight: bold;
      }

      .input-area {
        display: flex;
        flex-direction: column;
        gap: 15px;
      }

      input[type="number"] {
        font-size: 2em;
        padding: 15px;
        border: 3px solid #667eea;
        border-radius: 10px;
        text-align: center;
        width: 100%;
      }

      input[type="number"]:focus {
        outline: none;
        border-color: #764ba2;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
      }

      button {
        font-size: 1.3em;
        padding: 15px 30px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        font-weight: bold;
        transition: transform 0.2s, box-shadow 0.2s;
      }

      button:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
      }

      button:active {
        transform: translateY(0);
      }

      .feedback {
        font-size: 1.5em;
        font-weight: bold;
        min-height: 40px;
        transition: all 0.3s;
      }

      .feedback.correct {
        color: #28a745;
        animation: bounce 0.5s;
      }

      .feedback.incorrect {
        color: #dc3545;
        animation: shake 0.5s;
      }

      @keyframes bounce {
        0%,
        100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-10px);
        }
      }

      @keyframes shake {
        0%,
        100% {
          transform: translateX(0);
        }
        25% {
          transform: translateX(-10px);
        }
        75% {
          transform: translateX(10px);
        }
      }

      .start-screen,
      .game-screen {
        display: none;
      }

      .start-screen.active,
      .game-screen.active {
        display: block;
      }

      .leaderboard-screen {
        display: none;
      }

      .leaderboard-screen.active {
        display: block;
      }

      .instructions {
        text-align: left;
        background: #f8f9fa;
        padding: 20px;
        border-radius: 10px;
        margin-bottom: 20px;
      }

      .instructions h2 {
        color: #667eea;
        margin-bottom: 15px;
      }

      .instructions ul {
        margin-left: 20px;
        line-height: 1.8;
      }

      .time-bonus {
        font-size: 0.9em;
        color: #666;
        margin-top: 10px;
      }

      .results-screen {
        display: none;
      }

      .results-screen.active {
        display: block;
      }

      .results-container {
        background: #f8f9fa;
        padding: 30px;
        border-radius: 15px;
        margin-bottom: 30px;
      }

      .results-title {
        font-size: 2.5em;
        margin-bottom: 20px;
      }

      .results-stats {
        font-size: 1.3em;
        line-height: 2;
        margin-bottom: 20px;
      }

      .percentage {
        font-size: 3em;
        font-weight: bold;
        margin: 20px 0;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .feedback-message {
        font-size: 1.5em;
        line-height: 1.6;
        color: #333;
        margin: 20px 0;
        padding: 20px;
        background: white;
        border-radius: 10px;
        border-left: 5px solid #667eea;
      }

      .progress-indicator {
        font-size: 1.1em;
        color: #667eea;
        font-weight: bold;
        margin-bottom: 15px;
      }

      .number-keyboard {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 10px;
        margin-top: 20px;
      }

      .keyboard-container {
        display: flex;
        gap: 15px;
        justify-content: center;
        align-items: stretch;
      }

      .num-key {
        font-size: 1.8em;
        padding: 20px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        font-weight: bold;
        transition: all 0.2s;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }

      .num-key:hover {
        transform: translateY(-3px);
        box-shadow: 0 6px 12px rgba(102, 126, 234, 0.4);
      }

      .num-key:active {
        transform: translateY(0);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      }

      .num-key.zero {
        grid-column: 1 / 3;
      }

      .num-key.backspace {
        background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
        font-size: 1.5em;
      }

      .num-key.backspace:hover {
        box-shadow: 0 6px 12px rgba(220, 53, 69, 0.4);
      }

      .submit-btn {
        background: linear-gradient(135deg, #28a745 0%, #218838 100%);
        font-size: 1.5em;
        padding: 20px 25px;
        min-width: 70px;
        margin-top: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        writing-mode: horizontal-tb;
        white-space: nowrap;
      }

      .submit-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 6px 12px rgba(40, 167, 69, 0.4);
      }

      .leaderboard {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 10px;
        margin-top: 20px;
        text-align: left;
      }

      .leaderboard h3 {
        color: #667eea;
        margin-bottom: 15px;
        text-align: center;
        font-size: 1.5em;
      }

      .leaderboard-list {
        list-style: none;
        padding: 0;
      }

      .leaderboard-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px 15px;
        margin-bottom: 8px;
        background: white;
        border-radius: 8px;
        border-left: 4px solid #667eea;
        transition: transform 0.2s;
      }

      .leaderboard-item:hover {
        transform: translateX(5px);
      }

      .leaderboard-rank {
        font-weight: bold;
        color: #667eea;
        min-width: 30px;
      }

      .leaderboard-info {
        flex: 1;
        margin: 0 15px;
      }

      .leaderboard-score {
        font-weight: bold;
        color: #28a745;
        font-size: 1.1em;
      }

      .leaderboard-details {
        font-size: 0.85em;
        color: #666;
        margin-top: 3px;
      }

      .leaderboard-item.top1 {
        border-left-color: #ffd700;
        background: linear-gradient(135deg, #fff9e6 0%, #ffffff 100%);
      }

      .leaderboard-item.top1 .leaderboard-rank {
        color: #ffd700;
      }

      .leaderboard-item.top2 {
        border-left-color: #c0c0c0;
      }

      .leaderboard-item.top3 {
        border-left-color: #cd7f32;
      }

      .clear-leaderboard {
        margin-top: 10px;
        font-size: 0.9em;
        padding: 8px 15px;
        background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
      }

      .no-scores {
        text-align: center;
        color: #999;
        font-style: italic;
        padding: 20px;
      }

      .button-group {
        display: flex;
        gap: 10px;
        margin-top: 15px;
        flex-wrap: wrap;
        justify-content: center;
      }

      .button-group button {
        flex: 1;
        min-width: 140px;
      }

      .mode-screen {
        display: none;
      }

      .mode-screen.active {
        display: block;
      }

      .mode-selection {
        background: #f8f9fa;
        padding: 25px;
        border-radius: 15px;
        margin-bottom: 20px;
      }

      .mode-selection h2 {
        color: #667eea;
        margin-bottom: 20px;
        font-size: 1.8em;
      }

      .mode-buttons {
        display: flex;
        flex-direction: column;
        gap: 15px;
      }

      .mode-btn {
        padding: 20px;
        font-size: 1.2em;
        text-align: left;
        background: white;
        border: 3px solid #667eea;
        color: #667eea;
        border-radius: 10px;
        cursor: pointer;
        transition: all 0.3s;
      }

      .mode-btn:hover {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        transform: translateY(-2px);
      }

      .mode-btn .mode-title {
        font-weight: bold;
        font-size: 1.1em;
        margin-bottom: 8px;
      }

      .mode-btn .mode-desc {
        font-size: 0.85em;
        opacity: 0.9;
      }

      .number-selector {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 10px;
        margin-top: 15px;
      }

      .number-btn {
        padding: 15px;
        font-size: 1.3em;
        background: white;
        border: 2px solid #667eea;
        color: #667eea;
        border-radius: 8px;
        cursor: pointer;
        font-weight: bold;
        transition: all 0.2s;
      }

      .number-btn:hover {
        background: #667eea;
        color: white;
      }

      .mode-info {
        background: white;
        padding: 15px;
        border-radius: 8px;
        margin-top: 15px;
        border-left: 4px solid #667eea;
      }

      .language-selector {
        position: fixed;
        top: 20px;
        right: 20px;
        display: flex;
        gap: 10px;
        z-index: 1000;
      }

      .lang-btn {
        padding: 8px 15px;
        font-size: 0.9em;
        background: white;
        border: 2px solid #667eea;
        color: #667eea;
        border-radius: 8px;
        cursor: pointer;
        font-weight: bold;
        transition: all 0.2s;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      }

      .lang-btn:hover {
        background: #667eea;
        color: white;
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(102, 126, 234, 0.3);
      }

      .lang-btn.active {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-color: #764ba2;
      }

      .edit-name-btn {
        position: fixed;
        top: 20px;
        left: 20px;
        padding: 8px 15px;
        font-size: 0.9em;
        background: white;
        border: 2px solid #667eea;
        color: #667eea;
        border-radius: 8px;
        cursor: pointer;
        font-weight: bold;
        transition: all 0.2s;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        z-index: 1000;
      }

      .edit-name-btn:hover {
        background: #667eea;
        color: white;
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(102, 126, 234, 0.3);
      }
    </style>
  </head>
  <body>
    <!-- Edit Name Button -->
    <button class="edit-name-btn" id="editNameBtn" onclick="editPlayerName()">
      ‚úèÔ∏è <span id="editNameText">Edit Name</span>
    </button>

    <!-- Language Selector -->
    <div class="language-selector">
      <button class="lang-btn" id="langEn" onclick="switchLanguage('en')">
        English
      </button>
      <button class="lang-btn" id="langVi" onclick="switchLanguage('vi')">
        Ti·∫øng Vi·ªát
      </button>
    </div>

    <div class="game-container">
      <h1>Welcome ü¶Ñ to the</h1>
      <h1>Math Speed Game</h1>

      <!-- Start Screen -->
      <div class="start-screen active">
        <div class="instructions">
          <h2>üéØ How to Play:</h2>
          <ul>
            <li>Each game set has 15 questions</li>
            <li>
              Choose your mode: multiplication/division or addition/subtraction
            </li>
            <li>Numbers will be between 2 and 9</li>
            <li>Answer as quickly as you can!</li>
            <li>Faster answers = More points!</li>
            <li>
              Get bonus points for speed:
              <ul>
                <li>Under 3 seconds: 100 points</li>
                <li>Under 5 seconds: 50 points</li>
                <li>Under 10 seconds: 25 points</li>
                <li>Over 10 seconds: 10 points</li>
              </ul>
            </li>
            <li>Complete the set to see your results and feedback!</li>
          </ul>
        </div>
        <div class="button-group">
          <button onclick="showModeSelection()">Start Game!</button>
          <button
            onclick="showLeaderboard()"
            style="
              background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
            "
          >
            View Leaderboard
          </button>
        </div>
        <div class="instructions">
          <h2 align="center">Special developed by Chi√™u Qu√¢n's daddy</h2>
        </div>
      </div>

      <!-- Mode Selection Screen -->
      <div class="mode-screen">
        <div class="mode-selection">
          <h2>üéÆ Select Game Mode</h2>
          <div class="mode-buttons">
            <button class="mode-btn" onclick="startGame('addsub')">
              <div class="mode-title">‚ûï‚ûñ Addition & Subtraction Mode</div>
              <div class="mode-desc">Random + and - with numbers (2-9)</div>
            </button>
            <button class="mode-btn" onclick="startGame('random')">
              <div class="mode-title">‚úñ‚ûó Multiplication & Division Mode</div>
              <div class="mode-desc">Random x and √∑ with numbers (2-9)</div>
            </button>
            <button class="mode-btn" onclick="showFixedModeSelection()">
              <div class="mode-title">
                üéØ Multiplication & Division Practice Mode
              </div>
              <div class="mode-desc">
                Choose a specific number to practice (2-9)
              </div>
            </button>
          </div>
          <div class="mode-info" id="fixedModeSelector" style="display: none">
            <h3 style="color: #667eea; margin-bottom: 10px; font-size: 1.1em">
              Select number to practice:
            </h3>
            <div class="number-selector">
              <button class="number-btn" onclick="startGame('fixed', 2)">
                2
              </button>
              <button class="number-btn" onclick="startGame('fixed', 3)">
                3
              </button>
              <button class="number-btn" onclick="startGame('fixed', 4)">
                4
              </button>
              <button class="number-btn" onclick="startGame('fixed', 5)">
                5
              </button>
              <button class="number-btn" onclick="startGame('fixed', 6)">
                6
              </button>
              <button class="number-btn" onclick="startGame('fixed', 7)">
                7
              </button>
              <button class="number-btn" onclick="startGame('fixed', 8)">
                8
              </button>
              <button class="number-btn" onclick="startGame('fixed', 9)">
                9
              </button>
            </div>
          </div>
        </div>
        <button
          onclick="backToStart()"
          style="background: linear-gradient(135deg, #6c757d 0%, #495057 100%)"
        >
          Back to Menu
        </button>
      </div>

      <!-- Game Screen -->
      <div class="game-screen">
        <div class="progress-indicator" id="progress">Question 1 of 10</div>
        <div class="stats">
          <div class="stat-box">
            <div class="stat-label">Score</div>
            <div class="stat-value" id="score">0</div>
          </div>
          <div class="stat-box">
            <div class="stat-label">Correct</div>
            <div class="stat-value" id="correct">0</div>
          </div>
          <div class="stat-box">
            <div class="stat-label">Total</div>
            <div class="stat-value" id="total">0</div>
          </div>
        </div>

        <div class="question-area">
          <div class="question" id="question">2 √ó 3 = ?</div>
          <div class="time-bonus" id="timer">Time: 0.0s</div>
          <div class="input-area">
            <input
              type="number"
              id="answer"
              placeholder="Your answer"
              autofocus
              readonly
            />
            <div class="feedback" id="feedback"></div>
            <div class="keyboard-container">
              <div class="number-keyboard">
                <button class="num-key" onclick="inputNumber(1)">1</button>
                <button class="num-key" onclick="inputNumber(2)">2</button>
                <button class="num-key" onclick="inputNumber(3)">3</button>
                <button class="num-key" onclick="inputNumber(4)">4</button>
                <button class="num-key" onclick="inputNumber(5)">5</button>
                <button class="num-key" onclick="inputNumber(6)">6</button>
                <button class="num-key" onclick="inputNumber(7)">7</button>
                <button class="num-key" onclick="inputNumber(8)">8</button>
                <button class="num-key" onclick="inputNumber(9)">9</button>
                <button class="num-key zero" onclick="inputNumber(0)">0</button>
                <button class="num-key backspace" onclick="backspace()">
                  ‚å´
                </button>
              </div>
              <button class="submit-btn" onclick="checkAnswer()">Enter</button>
            </div>
          </div>
        </div>

        <button onclick="resetGame()">New Game</button>
        <button
          onclick="backToStart()"
          style="
            margin-top: 10px;
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
          "
        >
          Back to Menu
        </button>
      </div>

      <!-- Results Screen -->
      <div class="results-screen">
        <div class="results-container">
          <div class="results-title" id="resultsEmoji">üéâ</div>
          <div class="percentage" id="percentage">0%</div>
          <div class="results-stats" id="resultsStats"></div>
          <div class="feedback-message" id="feedbackMessage"></div>
        </div>
        <div class="button-group">
          <button onclick="startGame(gameMode, fixedNumber)">
            Play Another Set!
          </button>
          <button
            onclick="showLeaderboard()"
            style="
              background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
            "
          >
            View Leaderboard
          </button>
        </div>
        <button
          onclick="backToStart()"
          style="
            margin-top: 10px;
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
          "
        >
          Back to Menu
        </button>
      </div>

      <!-- Leaderboard Screen -->
      <div class="leaderboard-screen">
        <div class="leaderboard">
          <h3>üèÜ Leaderboard - Top 10</h3>
          <ul class="leaderboard-list" id="leaderboardList">
            <li class="no-scores">No scores yet. Play your first game!</li>
          </ul>
          <button
            class="clear-leaderboard"
            onclick="clearLeaderboard()"
            style="display: none"
            id="clearBtn"
          >
            Clear Leaderboard
          </button>
        </div>
        <button onclick="backToStart()" style="margin-top: 20px">
          Back to Menu
        </button>
      </div>
    </div>

    <script>
      // Language data
      let currentLanguage = localStorage.getItem("mathGameLanguage") || "vi";

      const translations = {
        en: {
          title1: "Welcome ü¶Ñ to the",
          title2: "Math Speed Game",
          howToPlay: "üéØ How to Play:",
          instructions: [
            "Each game set has 15 questions",
            "Choose your mode: multiplication/division or addition/subtraction",
            "Numbers will be between 2 and 9",
            "Answer as quickly as you can!",
            "Faster answers = More points!",
            "Get bonus points for speed:",
            "Under 3 seconds: 100 points",
            "Under 5 seconds: 50 points",
            "Under 10 seconds: 25 points",
            "Over 10 seconds: 10 points",
            "Complete the set to see your results and feedback!",
          ],
          startGame: "Start Game!",
          viewLeaderboard: "View Leaderboard",
          developedBy: "Special developed by Chi√™u Qu√¢n's daddy",
          selectMode: "üéÆ Select Game Mode",
          addSubMode: "‚ûï‚ûñ Addition & Subtraction Mode",
          addSubDesc: "Random + and - with numbers (2-9)",
          multDivMode: "‚úñ‚ûó Multiplication & Division Mode",
          multDivDesc: "Random x and √∑ with numbers (2-9)",
          practiceMode: "üéØ Multiplication & Division Practice Mode",
          practiceDesc: "Choose a specific number to practice (2-9)",
          selectNumber: "Select number to practice:",
          backToMenu: "Back to Menu",
          question: "Question",
          of: "of",
          score: "Score",
          correct: "Correct",
          total: "Total",
          time: "Time",
          yourAnswer: "Your answer",
          enter: "Enter",
          newGame: "New Game",
          backToMenuGame: "Back to Menu",
          playAnother: "Play Another Set!",
          leaderboardTitle: "üèÜ Leaderboard - Top 10",
          noScores: "No scores yet. Play your first game!",
          clearLeaderboard: "Clear Leaderboard",
          clearConfirm: "Are you sure you want to clear the leaderboard?",
          correctFeedback: "üéâ Correct!",
          incorrectFeedback: "‚ùå Oops! The answer was",
          points: "points!",
          outstanding: "Outstanding!",
          outstandingMsg:
            "You're a math superstar! Your speed and accuracy are incredible. Keep up the amazing work!",
          excellent: "Excellent work!",
          excellentMsg:
            "You did really well! With a bit more practice, you'll be perfect. Keep going!",
          goodJob: "Good job!",
          goodJobMsg:
            "You're doing great! Try to answer a bit faster next time to earn more points.",
          keepPracticing: "Keep practicing!",
          keepPracticingMsg:
            "You're getting better! Focus on accuracy first, then work on your speed.",
          greatEffort: "Great effort!",
          greatEffortMsg:
            "Everyone starts somewhere! Take your time and practice more. You'll improve with each game!",
          scoreLabel: "Score:",
          correctLabel: "Correct:",
          playerName: "Player",
          editName: "Edit Name",
          enterName: "Enter your name:",
          save: "Save",
          cancel: "Cancel",
        },
        vi: {
          title1: "Ch√†o m·ª´ng ü¶Ñ ƒë·∫øn v·ªõi",
          title2: "Tr√≤ Ch∆°i To√°n Nhanh",
          howToPlay: "üéØ C√°ch Ch∆°i:",
          instructions: [
            "M·ªói v√°n c√≥ 15 c√¢u h·ªèi",
            "Ch·ªçn ch·∫ø ƒë·ªô: nh√¢n/chia ho·∫∑c c·ªông/tr·ª´",
            "C√°c s·ªë t·ª´ 2 ƒë·∫øn 9",
            "Tr·∫£ l·ªùi c√†ng nhanh c√†ng t·ªët!",
            "Tr·∫£ l·ªùi nhanh = ƒêi·ªÉm cao h∆°n!",
            "ƒêi·ªÉm th∆∞·ªüng theo t·ªëc ƒë·ªô:",
            "D∆∞·ªõi 3 gi√¢y: 100 ƒëi·ªÉm",
            "D∆∞·ªõi 5 gi√¢y: 50 ƒëi·ªÉm",
            "D∆∞·ªõi 10 gi√¢y: 25 ƒëi·ªÉm",
            "Tr√™n 10 gi√¢y: 10 ƒëi·ªÉm",
            "Ho√†n th√†nh ƒë·ªÉ xem k·∫øt qu·∫£ v√† ph·∫£n h·ªìi!",
          ],
          startGame: "B·∫Øt ƒê·∫ßu Ch∆°i!",
          viewLeaderboard: "Xem B·∫£ng X·∫øp H·∫°ng",
          developedBy: "ƒê·∫∑c bi·ªát ph√°t tri·ªÉn b·ªüi Ba c·ªßa Chi√™u Qu√¢n",
          selectMode: "üéÆ Ch·ªçn Ch·∫ø ƒê·ªô Ch∆°i",
          addSubMode: "‚ûï‚ûñ Ch·∫ø ƒê·ªô C·ªông & Tr·ª´",
          addSubDesc: "Ng·∫´u nhi√™n + v√† - v·ªõi s·ªë (2-9)",
          multDivMode: "‚úñ‚ûó Ch·∫ø ƒê·ªô Nh√¢n & Chia",
          multDivDesc: "Ng·∫´u nhi√™n x v√† √∑ v·ªõi s·ªë (2-9)",
          practiceMode: "üéØ Ch·∫ø ƒê·ªô Luy·ªán T·∫≠p Nh√¢n & Chia",
          practiceDesc: "Ch·ªçn m·ªôt s·ªë c·ª• th·ªÉ ƒë·ªÉ luy·ªán t·∫≠p (2-9)",
          selectNumber: "Ch·ªçn s·ªë ƒë·ªÉ luy·ªán t·∫≠p:",
          backToMenu: "V·ªÅ Menu",
          question: "C√¢u",
          of: "tr√™n",
          score: "ƒêi·ªÉm",
          correct: "ƒê√∫ng",
          total: "T·ªïng",
          time: "Th·ªùi gian",
          yourAnswer: "C√¢u tr·∫£ l·ªùi",
          enter: "Nh·∫≠p",
          newGame: "V√°n M·ªõi",
          backToMenuGame: "V·ªÅ Menu",
          playAnother: "Ch∆°i Ti·∫øp!",
          leaderboardTitle: "üèÜ B·∫£ng X·∫øp H·∫°ng - Top 10",
          noScores: "Ch∆∞a c√≥ ƒëi·ªÉm n√†o. Ch∆°i v√°n ƒë·∫ßu ti√™n!",
          clearLeaderboard: "X√≥a B·∫£ng X·∫øp H·∫°ng",
          clearConfirm: "B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a b·∫£ng x·∫øp h·∫°ng?",
          correctFeedback: "üéâ Ch√≠nh x√°c!",
          incorrectFeedback: "‚ùå ·ªêi! ƒê√°p √°n l√†",
          points: "ƒëi·ªÉm!",
          outstanding: "Xu·∫•t s·∫Øc!",
          outstandingMsg:
            "Con l√† ng√¥i sao to√°n h·ªçc! T·ªëc ƒë·ªô v√† ƒë·ªô ch√≠nh x√°c tuy·ªát v·ªùi. Ti·∫øp t·ª•c ph√°t huy nh√©!",
          excellent: "L√†m t·ªët l·∫Øm!",
          excellentMsg:
            "Con l√†m r·∫•t t·ªët! Luy·ªán t·∫≠p th√™m m·ªôt ch√∫t n·ªØa l√† ho√†n h·∫£o. C·ªë l√™n!",
          goodJob: "L√†m t·ªët!",
          goodJobMsg:
            "Con ƒëang l√†m r·∫•t t·ªët! L·∫ßn sau th·ª≠ tr·∫£ l·ªùi nhanh h∆°n ƒë·ªÉ ƒë∆∞·ª£c nhi·ªÅu ƒëi·ªÉm h∆°n nh√©.",
          keepPracticing: "Ti·∫øp t·ª•c luy·ªán t·∫≠p!",
          keepPracticingMsg:
            "Con ƒëang ti·∫øn b·ªô! T·∫≠p trung v√†o ƒë·ªô ch√≠nh x√°c tr∆∞·ªõc, r·ªìi sau ƒë√≥ tƒÉng t·ªëc ƒë·ªô.",
          greatEffort: "C·ªë g·∫Øng tuy·ªát v·ªùi!",
          greatEffortMsg:
            "Ai c≈©ng c√≥ l√∫c b·∫Øt ƒë·∫ßu! T·ª´ t·ª´ th√¥i v√† luy·ªán t·∫≠p nhi·ªÅu h∆°n. Con s·∫Ω ti·∫øn b·ªô sau m·ªói v√°n ch∆°i!",
          scoreLabel: "ƒêi·ªÉm:",
          correctLabel: "ƒê√∫ng:",
          playerName: "Ng∆∞·ªùi ch∆°i",
          editName: "ƒê·ªïi T√™n",
          enterName: "Nh·∫≠p t√™n c·ªßa b·∫°n:",
          save: "L∆∞u",
          cancel: "H·ªßy",
        },
      };

      let score = 0;
      let correctAnswers = 0;
      let totalQuestions = 0;
      let currentAnswer = 0;
      let startTime = 0;
      let timerInterval = null;
      let questionsInSet = 0;
      let maxPossibleScore = 0;
      let gameMode = "random";
      let fixedNumber = null;
      let playerName = localStorage.getItem("mathGamePlayerName") || "";

      // Leaderboard functions
      function saveScore(score, maxScore, correct, total, percentage) {
        const scores = getLeaderboard();
        const newScore = {
          score: score,
          maxScore: maxScore,
          correct: correct,
          total: total,
          percentage: percentage,
          date: new Date().toLocaleString(),
          playerName: playerName || getText("playerName"),
        };

        scores.unshift(newScore); // Add to beginning

        // Keep only top 10
        if (scores.length > 10) {
          scores.pop();
        }

        localStorage.setItem("mathGameLeaderboard", JSON.stringify(scores));
        displayLeaderboard();
      }

      function getLeaderboard() {
        const stored = localStorage.getItem("mathGameLeaderboard");
        return stored ? JSON.parse(stored) : [];
      }

      function displayLeaderboard() {
        const scores = getLeaderboard();
        const list = document.getElementById("leaderboardList");
        const clearBtn = document.getElementById("clearBtn");

        if (scores.length === 0) {
          list.innerHTML = `<li class="no-scores">${getText("noScores")}</li>`;
          clearBtn.style.display = "none";
          return;
        }

        clearBtn.style.display = "block";

        list.innerHTML = scores
          .map((item, index) => {
            const rank = index + 1;
            let rankClass = "";
            let medal = "";

            if (rank === 1) {
              rankClass = "top1";
              medal = "ü•á ";
            } else if (rank === 2) {
              rankClass = "top2";
              medal = "ü•à ";
            } else if (rank === 3) {
              rankClass = "top3";
              medal = "ü•â ";
            }

            const displayName = item.playerName || getText("playerName");
            return `
            <li class="leaderboard-item ${rankClass}">
              <span class="leaderboard-rank">${medal}#${rank}</span>
              <div class="leaderboard-info">
                <div class="leaderboard-score">${displayName}: ${item.score} / ${item.maxScore} (${item.percentage}%)</div>
                <div class="leaderboard-details">${item.correct}/${item.total} correct ‚Ä¢ ${item.date}</div>
              </div>
            </li>
          `;
          })
          .join("");
      }

      function clearLeaderboard() {
        if (confirm(translations[currentLanguage].clearConfirm)) {
          localStorage.removeItem("mathGameLeaderboard");
          displayLeaderboard();
        }
      }

      function switchLanguage(lang) {
        currentLanguage = lang;
        localStorage.setItem("mathGameLanguage", lang);
        updateAllText();
        updateLanguageButtons();
      }

      function updateLanguageButtons() {
        document
          .getElementById("langEn")
          .classList.toggle("active", currentLanguage === "en");
        document
          .getElementById("langVi")
          .classList.toggle("active", currentLanguage === "vi");
      }

      function editPlayerName() {
        const newName = prompt(getText("enterName"), playerName || "");
        if (newName !== null && newName.trim() !== "") {
          playerName = newName.trim();
          localStorage.setItem("mathGamePlayerName", playerName);
          updatePlayerNameDisplay();
        }
      }

      function updatePlayerNameDisplay() {
        const displayName = playerName || getText("playerName");
        const titleElement = document.querySelectorAll("h1")[0];
        if (playerName) {
          titleElement.textContent = getText("title1").replace(
            "ü¶Ñ",
            displayName
          );
        } else {
          editPlayerName();
        }
      }

      function getText(key) {
        return translations[currentLanguage][key] || key;
      }

      function updateAllText() {
        // Update title with player name
        updatePlayerNameDisplay();
        document.querySelectorAll("h1")[1].textContent = getText("title2");

        // Update instructions
        const instructionsTitle = document.querySelector(".instructions h2");
        if (instructionsTitle) {
          instructionsTitle.textContent = getText("howToPlay");
        }

        const instructionsList = document.querySelector(".instructions ul");
        if (instructionsList) {
          const instructions = getText("instructions");
          instructionsList.innerHTML = instructions
            .map((item, index) => {
              if (index === 5) {
                // "Get bonus points for speed:" with nested list
                return `<li>${item}<ul>
                  <li>${instructions[6]}</li>
                  <li>${instructions[7]}</li>
                  <li>${instructions[8]}</li>
                  <li>${instructions[9]}</li>
                </ul></li>`;
              } else if (index > 5 && index < 10) {
                return ""; // Skip these as they're nested
              }
              return `<li>${item}</li>`;
            })
            .join("");
        }

        // Update buttons on start screen
        document.querySelectorAll(
          ".start-screen .button-group button"
        )[0].textContent = getText("startGame");
        document.querySelectorAll(
          ".start-screen .button-group button"
        )[1].textContent = getText("viewLeaderboard");

        document.querySelectorAll(".instructions h2")[1].textContent =
          getText("developedBy");

        // Update mode selection
        document.querySelector(".mode-selection h2").textContent =
          getText("selectMode");

        const modeButtons = document.querySelectorAll(".mode-btn");
        if (modeButtons[0]) {
          modeButtons[0].querySelector(".mode-title").textContent =
            getText("addSubMode");
          modeButtons[0].querySelector(".mode-desc").textContent =
            getText("addSubDesc");
        }
        if (modeButtons[1]) {
          modeButtons[1].querySelector(".mode-title").textContent =
            getText("multDivMode");
          modeButtons[1].querySelector(".mode-desc").textContent =
            getText("multDivDesc");
        }
        if (modeButtons[2]) {
          modeButtons[2].querySelector(".mode-title").textContent =
            getText("practiceMode");
          modeButtons[2].querySelector(".mode-desc").textContent =
            getText("practiceDesc");
        }

        document.querySelector("#fixedModeSelector h3").textContent =
          getText("selectNumber");

        // Update stat labels
        document.querySelectorAll(".stat-label")[0].textContent =
          getText("score");
        document.querySelectorAll(".stat-label")[1].textContent =
          getText("correct");
        document.querySelectorAll(".stat-label")[2].textContent =
          getText("total");

        // Update input placeholder
        document.getElementById("answer").placeholder = getText("yourAnswer");

        // Update submit button
        document.querySelector(".submit-btn").textContent = getText("enter");

        // Update game screen buttons
        document.querySelector(".game-screen > button").textContent =
          getText("newGame");
        document.querySelectorAll(".game-screen > button")[1].textContent =
          getText("backToMenuGame");

        // Update results screen buttons
        const resultsButtons = document.querySelectorAll(
          ".results-screen .button-group button"
        );
        if (resultsButtons[0]) {
          resultsButtons[0].textContent = getText("playAnother");
        }
        if (resultsButtons[1]) {
          resultsButtons[1].textContent = getText("viewLeaderboard");
        }

        // Update back to menu buttons
        document
          .querySelectorAll('button[onclick="backToStart()"]')
          .forEach((btn) => {
            btn.textContent = getText("backToMenu");
          });

        // Update leaderboard
        document.querySelector(".leaderboard h3").textContent =
          getText("leaderboardTitle");
        document.querySelector(".clear-leaderboard").textContent =
          getText("clearLeaderboard");

        // Update edit name button
        document.getElementById("editNameText").textContent =
          getText("editName");

        // Update progress if in game
        if (totalQuestions < questionsInSet) {
          updateProgress();
        }

        // Refresh leaderboard display
        displayLeaderboard();
      }

      function inputNumber(num) {
        const answerInput = document.getElementById("answer");
        const currentValue = answerInput.value;
        answerInput.value = currentValue + num;
      }

      function backspace() {
        const answerInput = document.getElementById("answer");
        answerInput.value = answerInput.value.slice(0, -1);
      }

      function showModeSelection() {
        document.querySelector(".start-screen").classList.remove("active");
        document.querySelector(".mode-screen").classList.add("active");
      }

      function showFixedModeSelection() {
        document.getElementById("fixedModeSelector").style.display = "block";
      }

      function startGame(mode = "random", fixedNum = null) {
        gameMode = mode;
        fixedNumber = fixedNum;

        document.querySelector(".start-screen").classList.remove("active");
        document.querySelector(".mode-screen").classList.remove("active");
        document.querySelector(".results-screen").classList.remove("active");
        document.querySelector(".game-screen").classList.add("active");
        resetGame();
      }

      function backToStart() {
        document.querySelector(".results-screen").classList.remove("active");
        document
          .querySelector(".leaderboard-screen")
          .classList.remove("active");
        document.querySelector(".mode-screen").classList.remove("active");
        document.querySelector(".game-screen").classList.remove("active");
        document.querySelector(".start-screen").classList.add("active");
        document.getElementById("fixedModeSelector").style.display = "none";
      }

      function showLeaderboard() {
        document.querySelector(".start-screen").classList.remove("active");
        document.querySelector(".results-screen").classList.remove("active");
        document.querySelector(".leaderboard-screen").classList.add("active");
        displayLeaderboard();
      }

      function resetGame() {
        score = 0;
        correctAnswers = 0;
        totalQuestions = 0;
        questionsInSet = 15; // Fixed 15 questions
        maxPossibleScore = 0;
        updateStats();
        updateProgress();
        generateQuestion();
      }

      function updateProgress() {
        document.getElementById("progress").textContent = `${getText(
          "question"
        )} ${totalQuestions + 1} ${getText("of")} ${questionsInSet}`;
      }

      function generateQuestion() {
        // Clear feedback and input
        document.getElementById("feedback").textContent = "";
        document.getElementById("feedback").className = "feedback";
        document.getElementById("answer").value = "";
        document.getElementById("answer").focus();

        // Generate random numbers between 2 and 9
        let num1, num2;

        if (gameMode === "fixed" && fixedNumber) {
          // Fixed mode: second operand is always the fixed number
          num1 = Math.floor(Math.random() * 8) + 2;
          num2 = fixedNumber;
        } else {
          // Random mode: both numbers are random
          num1 = Math.floor(Math.random() * 8) + 2;
          num2 = Math.floor(Math.random() * 8) + 2;
        }

        // Choose operations based on game mode
        let operations, operation;
        if (gameMode === "addsub") {
          // Addition and subtraction mode
          operations = ["+", "-"];
        } else {
          // Default multiplication and division mode
          operations = ["√ó", "√∑"];
        }
        operation = operations[Math.floor(Math.random() * operations.length)];

        let questionText = "";

        if (operation === "√ó") {
          currentAnswer = num1 * num2;
          questionText = `${num1} √ó ${num2} = ?`;
        } else if (operation === "√∑") {
          // For division, ensure we get a whole number result
          currentAnswer = num1;
          const dividend = num2 * num1;
          questionText = `${dividend} √∑ ${num2} = ?`;
        } else if (operation === "+") {
          currentAnswer = num1 + num2;
          questionText = `${num1} + ${num2} = ?`;
        } else if (operation === "-") {
          currentAnswer = num1;
          const subtrahend = num2 + num1;
          questionText = `${subtrahend} - ${num2} = ?`;
        }

        document.getElementById("question").textContent = questionText;

        // Track maximum possible score (if answered within 3 seconds)
        maxPossibleScore += 100;

        // Start timer
        startTime = Date.now();
        if (timerInterval) clearInterval(timerInterval);
        timerInterval = setInterval(updateTimer, 100);
      }

      function updateTimer() {
        const elapsed = (Date.now() - startTime) / 1000;
        document.getElementById("timer").textContent = `${getText(
          "time"
        )}: ${elapsed.toFixed(1)}s`;
      }

      function checkAnswer() {
        const userAnswer = parseInt(document.getElementById("answer").value);

        if (isNaN(userAnswer)) {
          return;
        }

        // Stop timer
        clearInterval(timerInterval);
        const timeTaken = (Date.now() - startTime) / 1000;

        totalQuestions++;
        const feedback = document.getElementById("feedback");

        if (userAnswer === currentAnswer) {
          correctAnswers++;

          // Calculate points based on speed
          let points = 10;
          if (timeTaken < 3) {
            points = 100;
          } else if (timeTaken < 5) {
            points = 50;
          } else if (timeTaken < 10) {
            points = 25;
          }

          score += points;

          feedback.textContent = `${getText(
            "correctFeedback"
          )} +${points} ${getText("points")} (${timeTaken.toFixed(1)}s)`;
          feedback.className = "feedback correct";
        } else {
          feedback.textContent = `${getText(
            "incorrectFeedback"
          )} ${currentAnswer}`;
          feedback.className = "feedback incorrect";
        }

        updateStats();
        updateProgress();

        // Check if game set is complete
        if (totalQuestions >= questionsInSet) {
          setTimeout(showResults, 2000);
        } else {
          // Generate next question after a short delay
          setTimeout(generateQuestion, 2000);
        }
      }

      function showResults() {
        clearInterval(timerInterval);
        document.querySelector(".game-screen").classList.remove("active");
        document.querySelector(".results-screen").classList.add("active");

        const percentage = Math.round((score / maxPossibleScore) * 100);
        const accuracy = Math.round((correctAnswers / totalQuestions) * 100);

        // Save to leaderboard
        saveScore(
          score,
          maxPossibleScore,
          correctAnswers,
          totalQuestions,
          percentage
        );

        document.getElementById("percentage").textContent = `${percentage}%`;
        document.getElementById("resultsStats").innerHTML =
          `üìä <strong>${getText(
            "scoreLabel"
          )}</strong> ${score} / ${maxPossibleScore}<br>` +
          `‚úÖ <strong>${getText(
            "correctLabel"
          )}</strong> ${correctAnswers} / ${totalQuestions} (${accuracy}%)`;

        // Determine feedback based on percentage
        let emoji, message;
        if (percentage >= 99) {
          emoji = "üèÜ";
          message = `<strong>${getText("outstanding")}</strong> ${getText(
            "outstandingMsg"
          )}`;
        } else if (percentage >= 90) {
          emoji = "üåü";
          message = `<strong>${getText("excellent")}</strong> ${getText(
            "excellentMsg"
          )}`;
        } else if (percentage >= 80) {
          emoji = "üëç";
          message = `<strong>${getText("goodJob")}</strong> ${getText(
            "goodJobMsg"
          )}`;
        } else if (percentage >= 70) {
          emoji = "üí™";
          message = `<strong>${getText("keepPracticing")}</strong> ${getText(
            "keepPracticingMsg"
          )}`;
        } else {
          emoji = "üå±";
          message = `<strong>${getText("greatEffort")}</strong> ${getText(
            "greatEffortMsg"
          )}`;
        }

        document.getElementById("resultsEmoji").textContent = emoji;
        document.getElementById("feedbackMessage").innerHTML = message;
      }

      function updateStats() {
        document.getElementById("score").textContent = score;
        document.getElementById("correct").textContent = correctAnswers;
        document.getElementById("total").textContent = totalQuestions;
      }

      // Focus management
      document.addEventListener("DOMContentLoaded", function () {
        // Keep focus visible but prevent physical keyboard input
        document
          .getElementById("answer")
          .addEventListener("focus", function () {
            this.setAttribute("readonly", "readonly");
          });

        // Load language and update text
        updateAllText();
        updateLanguageButtons();

        // Load leaderboard on start
        displayLeaderboard();
      });
    </script>
  </body>
</html>
